generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model IndexerCursor {
  id        String   @id
  lastBlock BigInt   @map("last_block")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("indexer_cursor")
}

model IndexedMarket {
  marketId        String    @id @map("market_id")
  question        String?
  marketAddress   String    @unique @map("market_address")
  closeTime       BigInt    @map("close_time")
  status          String
  resolvedOutcome Int?      @map("resolved_outcome")
  createTxHash    String?   @map("create_tx_hash")
  createBlock     BigInt?   @map("create_block")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")
  trades          IndexedTrade[]
  claims          IndexedClaim[]

  @@map("indexed_markets")
}

model IndexedTrade {
  id           BigInt   @id @default(autoincrement())
  marketAddress String  @map("market_address")
  walletAddress String  @map("wallet_address")
  action       String   @default("BUY")
  side         String
  amount       String
  txHash       String   @map("tx_hash")
  logIndex     Int      @map("log_index")
  blockNumber  BigInt   @map("block_number")
  createdAt    DateTime @default(now()) @map("created_at")
  market       IndexedMarket @relation(fields: [marketAddress], references: [marketAddress], onDelete: Cascade)

  @@unique([txHash, logIndex])
  @@map("indexed_trades")
}

model IndexedClaim {
  id           BigInt   @id @default(autoincrement())
  marketAddress String  @map("market_address")
  walletAddress String  @map("wallet_address")
  payout       String
  txHash       String   @map("tx_hash")
  logIndex     Int      @map("log_index")
  blockNumber  BigInt   @map("block_number")
  createdAt    DateTime @default(now()) @map("created_at")
  market       IndexedMarket @relation(fields: [marketAddress], references: [marketAddress], onDelete: Cascade)

  @@unique([txHash, logIndex])
  @@map("indexed_claims")
}

model AuthNonce {
  id          BigInt   @id @default(autoincrement())
  address     String
  nonce       String   @unique
  chainId     Int      @map("chain_id")
  uri         String
  domain      String
  expiresAt   DateTime @map("expires_at")
  consumedAt  DateTime? @map("consumed_at")
  createdAt   DateTime @default(now()) @map("created_at")

  @@index([address, expiresAt])
  @@map("auth_nonces")
}

model AuthSession {
  id          BigInt   @id @default(autoincrement())
  tokenHash   String   @unique @map("token_hash")
  address     String
  chainId     Int      @map("chain_id")
  domain      String
  uri         String
  issuedAt    DateTime @map("issued_at")
  expiresAt   DateTime @map("expires_at")
  revokedAt   DateTime? @map("revoked_at")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@index([address, expiresAt])
  @@map("auth_sessions")
}
