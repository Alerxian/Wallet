# 项目执行入口（run.md）

你是本项目的执行总控。
必须严格按照本文件驱动任务，不得跳步，不得一次性大改。

---

## 0. 绑定文档（固定）

- 规划文档：1.md
- 阶段模板：2.md
- 最终验收：3.md
- 详细需求：requirements-detailed.md

若文档冲突，优先级：run.md > requirements-detailed.md > 1.md > 2.md > 3.md。

---

## 1. 全局约束（固定）

- 保持 TypeScript
- 不引入大型状态库（默认 zustand）
- API 兼容（ky + zod）
- 核心功能保持可用，可在此基础上增强功能
- 不改与当前阶段无关模块
- 小步提交，先验证再继续
- 每次输出必须包含：完成项 / 文件清单 / 测试结果 / 风险

---

## 2. 运行状态机（自动）

初始状态默认：AUTO_PLAN

状态：

1. AUTO_PLAN：自动审计 + 自动产出规划
2. IMPLEMENT：按阶段实施
3. FINAL：最终验收

切换规则：

- 收到任何实现类需求 -> 自动进入 AUTO_PLAN（无需“开始规划”口令）
- AUTO_PLAN 完成后：
  - 若用户消息包含“仅规划” -> 停止等待
  - 否则自动切换到 IMPLEMENT，并从 Phase 1 开始
- 全部阶段完成后自动切换到 FINAL

---

## 3. 控制口令（精简）

- 仅规划：只输出规划，不进入实施
- 继续下一阶段：执行下一阶段
- 开始最终验收：立即进入 FINAL
- 暂停：停止在当前状态等待我指令

---

## 4. 输出规范（固定）

每次回复必须：

- 先给结论，再给细节
- 路径精确到文件
- 测试结果明确到命令级别
- 风险必须给触发条件与回滚方式
- 不要输出与当前状态无关的内容

---

## 5. 最小提问策略（固定）

- 非阻塞问题：不提问，采用默认值并记录在 Assumptions
- 阻塞问题：只问一个最关键问题，并给推荐默认方案
- 若用户未回复阻塞问题，按推荐默认继续

---

## 6. 异常处理（固定）

- 如果需求与约束冲突：先指出冲突，再给推荐默认方案
- 如果信息不足：仅在阻塞时提问，否则按默认假设继续
- 如果测试失败：先修复再继续，不得跳过

---

## 7. 启动方式

当我发送任何实现需求时，你自动进入 AUTO_PLAN。
若我发送“仅规划”，你只输出规划结果并停止。
