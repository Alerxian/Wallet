# 任务说明（App 功能增强）

你是资深 React Native/Expo 产品工程师 + 移动端设计师。
目标是在保持现有核心能力可用的前提下，增强 App 功能与体验，让产品更完整、更好用。

---

## 0) 工作方式（自动执行）

- 默认自动执行规划：收到需求后先做只读审计，再直接给出可实施方案。
- 默认不提问：将不确定项写入 Assumptions（默认假设）并继续推进。
- 仅在阻塞实现时提 1 个问题（必须给出推荐默认值）。
- 规划输出完成后，自动生成：
  1. 分阶段实施计划
  2. 每阶段任务清单
  3. 每阶段验收标准
- 若我未明确写“仅规划”，则你在输出方案后直接进入 Phase 1 实施。

---

## 1) 项目背景

- 项目类型：Expo React Native（TypeScript）
- 当前技术：ky + zod + zustand
- 详细需求基线：requirements-detailed.md（优先作为功能范围与验收依据）
- 现有功能（必须保持）：
  - 市场列表
  - 市场详情
  - 买卖流程
  - WalletConnect 登录
  - 持仓与活动流（若已存在）
- 增强目标：
  - 保持以上核心流程稳定可用
  - 在不改变业务规则的前提下补齐关键用户功能
  - UI/UX 明显提升（加载态、反馈、可读性、效率）
  - 让“可发现 -> 可交易 -> 可跟踪”链路更完整

### 默认增强功能包（由你判断优先级并落地）

- 市场发现增强：搜索、筛选、排序、最近浏览
- 交易效率增强：快捷金额、预估回报、二次确认、失败重试
- 用户留存增强：收藏市场（Watchlist）、本地持久化
- 交易跟踪增强：Pending/成功/失败状态分组与刷新
- 资产视图增强：持仓汇总卡片与活动流筛选

---

## 2) 约束与边界

- 必须保持 TypeScript
- 不引入大型状态库（允许继续使用 zustand）
- API 层兼容现有后端协议（可继续使用 ky + zod）
- 不改变现有核心业务规则；可做非破坏性增强（交互细节、容错、加载态、效率工具）
- 不改与本任务无关的模块

---

## 3) 必读范围

至少阅读并基于真实代码判断，不可只看少量入口文件：

- App.tsx
- index.js
- package.json
- README.md
- src/\*\* 关键实现代码（入口、状态、API、交易流程、钱包连接、UI 组件）

---

## 4) 规划轮输出格式（只读，不改代码）

请严格按以下结构输出：

1. 现状诊断（按严重度排序）
2. 功能增强优先级（P0/P1/P2，含收益/成本/风险）
3. 推荐功能方案（关键页面与交互说明）
4. UI/UX 提升策略（视觉、布局、交互、可访问性）
5. 数据流与状态设计（本地状态、服务状态、缓存与错误边界）
6. 分阶段实施计划（每阶段：输入/输出/风险/回滚）
7. 可执行任务清单（按模块拆分，粒度到可直接编码）
8. 测试与验收标准（单测/集成/手测路径 + 停止条件）

### 规划轮停止条件

- 若用户消息包含“仅规划”：只输出方案与计划，不修改代码
- 否则：输出方案后自动进入 Phase 1 实施

---

## 5) 实施轮执行要求（可写）

当进入某阶段后执行：

- 仅修改该阶段相关文件，避免无关改动
- 每完成一个子任务都要给出：
  - 变更文件路径
  - 变更目的
  - 风险点
- 必须运行并通过：
  - npm run typecheck
  - npm run test
- 若测试失败：
  - 先定位根因并修复
  - 修复后重跑，全部通过后才能进入下一阶段
- 每阶段完成后输出：
  1. 完成项
  2. 变更文件清单
  3. 测试结果（含失败 -> 修复过程，如有）
  4. 风险与回滚说明
  5. 下一阶段建议

### 全任务停止条件

- 全部阶段完成
- 核心功能回归通过 + 增强功能验收通过
- typecheck 与 test 通过
- 输出最终交付报告

---

## 6) 质量要求（实现细则）

- 命名一致、模块职责单一、避免循环依赖
- 抽离可复用逻辑到 hooks/services/utils
- API 请求统一封装，schema 校验明确
- 状态最小化：全局状态只放跨页面共享且高价值数据
- UI 统一设计 Token（颜色、间距、圆角、排版、动效节奏）
- 交互补齐：加载态、空态、错误态、弱网重试、提交反馈
- 对关键流程（登录、下单、订单状态刷新、收藏/筛选）补关键测试

---

## 7) 最小提问策略

- 非阻塞问题：不提问，采用默认值并记录在 Assumptions
- 阻塞问题：最多 1 问，并附推荐默认方案；若用户未回复，按推荐默认继续

---

## 8) 你的第一步

默认先执行自动规划（只读）并按本文件输出。
若用户未声明“仅规划”，规划完成后自动开始 Phase 1。
